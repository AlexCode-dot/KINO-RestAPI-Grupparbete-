<% layout('layouts/main') %>

<main>
  <h1>Välkommen till KINO Kvikkjokk</h1>
  <p>Här är filmerna med bäst recensioner</p>

  <h2>Senaste recensionerna</h2>
  <div id="reviews-container">
    <p>Laddar recensioner...</p>
  </div>
</main>

<script>
    //Väntar på sidladdning för att vi ska kunna göra DOM manipulation
  document.addEventListener("DOMContentLoaded", async () => {
    const reviewsContainer = document.querySelector("#reviews-container");

    const fetchLatestReviews = async () => {
      try {
        const response = await fetch("/api/reviews/latest");
        if (!response.ok) throw new Error("Failed to fetch");

        const reviews = await response.json();

        //Map och join skapar HTML ist flr att iterera m foreach loop
        reviewsContainer.innerHTML = reviews.length
          ? reviews.map(review => `
            <div>
              <strong>${review.author || "Anonym"}</strong> - ${review.rating}/10
              <p>${review.comment}</p>
            </div>
          `).join("")
          : "<p>Inga recensioner tillgängliga ännu.</p>";
      } catch (error) {
        console.error("Error loading reviews:", error);
        reviewsContainer.innerHTML = "<p>Misslyckades att ladda recensioner.</p>";
      }
    };

    fetchLatestReviews();
  });
</script>
