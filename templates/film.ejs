<% layout('layouts/main') %>
<div class="top__movieTitle">
  <h1>
    <%= movie.title %>
  </h1>    
</div>
<div class="singleMovie__main">
  <div class="singleMovie__leftContainer">  
     <div class="singleMovie__main-poster">
       <% if (movie.image) { %>
         <img src="<%= movie.image.url %>">
         <% } %>
    </div>
  </div>

  <div class="singleMovie__rightContainer">
     <div class="singleMovie__main-info">
       <div class="singleMovie__main-rating">Rating: 5</div>
       <div class="singleMovie__main-description"><h3>Handling:</h3> <%- movie.intro %></div>    
     </div>
     <div class="singleMovie__main-screenings">
       <h2>Kommande visningar</h2>
       <div class="singleMovie__screenings">
         THIS WILL CONTAIN UPPCOMMING SCREENINGS
       </div>
     </div>
  </div>
</div>

<div class="singleMovie__reviews">
  <h1>Recensioner</h1>
  <div id="reviews-container" class="singleMovie__reviewContainer">
    <p>Laddar recensioner...</p>
  </div>
  <script>
    
    document.addEventListener("DOMContentLoaded", async () => {
      const reviewsContainer = document.querySelector("#reviews-container");
      const movieId = "<%= movie.id %>"; // Hämtar filmens ID från EJS-servern
  
      const fetchReviews = async () => {
        try {
          console.log(`Hämtar recensioner för film-ID: ${movieId}...`);
          const response = await fetch(`/api/reviews/movie/${movieId}`);
  
          if (!response.ok) throw new Error("Misslyckades att hämta recensioner!");
  
          const reviews = await response.json();
          console.log("Fetched Reviews:", reviews);
  
          reviewsContainer.innerHTML = reviews.length
            ? reviews.map(review => `
              <div class="review">
                <strong>${review.author || "Anonym"}</strong> - ${review.rating}/10
                <p>${review.comment}</p>
              </div>
            `).join("")
            : "<p>Inga recensioner tillgängliga ännu.</p>";
        } catch (error) {
          console.error("Fel vid hämtning av recensioner:", error);
          reviewsContainer.innerHTML = "<p>Misslyckades att ladda recensioner.</p>";
        }
      };
  
      await fetchReviews();
    });
  </script>
  

</div>

<div class="singleMovie__addReviews">
  <h1>Skriv en recension</h1>
  <div class="singleMovie__addReviewsContainer">THIS WILL CONTAIN INPUT FOR USER TO ADD REVIEW</div>
</div>